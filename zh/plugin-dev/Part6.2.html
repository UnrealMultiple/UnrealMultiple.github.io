<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.22" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Part 6.1发送数据包​","image":[""],"dateModified":"2025-09-11T05:14:27.000Z","author":[]}</script><meta property="og:url" content="http://docs.terraria.ink/zh/plugin-dev/Part6.2.html"><meta property="og:site_name" content="TShock中文插件库"><meta property="og:title" content="Part 6.1发送数据包​"><meta property="og:description" content="Part 6.1发送数据包​ 本章你将学到： 如何向玩家发送数据包 研究不同数据包参数的方法 什么是数据包？​ 顾名思义，数据包就是存放数据的包。这些包会告诉玩家的客户端一些游戏内的信息(例如物品掉落、地图时间等)，当然服务器也可以接受来自玩家的数据包​ 为什么要发送数据包？​ 当你直接修改Terraria服务端中的属性、变量等(例如：玩家最大血量、下..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-09-11T05:14:27.000Z"><meta property="article:modified_time" content="2025-09-11T05:14:27.000Z"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="26x26" href="/images/icons/boom.png"><link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="TShock中文插件库"><meta name="apple-mobile-web-app-title" content="TShock中文插件库"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#3eaf7c"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>Part 6.1发送数据包​ | TShock中文插件库</title><meta name="description" content="Part 6.1发送数据包​ 本章你将学到： 如何向玩家发送数据包 研究不同数据包参数的方法 什么是数据包？​ 顾名思义，数据包就是存放数据的包。这些包会告诉玩家的客户端一些游戏内的信息(例如物品掉落、地图时间等)，当然服务器也可以接受来自玩家的数据包​ 为什么要发送数据包？​ 当你直接修改Terraria服务端中的属性、变量等(例如：玩家最大血量、下...">
    <link rel="preload" href="/assets/style-CcUprB4m.css" as="style"><link rel="stylesheet" href="/assets/style-CcUprB4m.css">
    <link rel="modulepreload" href="/assets/app-DaEuJxNx.js"><link rel="modulepreload" href="/assets/Part6.2.html-B3QcI74f.js">
    <link rel="prefetch" href="/assets/index.html-D2WGrEOK.js" as="script"><link rel="prefetch" href="/assets/index.html-C_5AVHPf.js" as="script"><link rel="prefetch" href="/assets/get-start.html-DIqW9jVG.js" as="script"><link rel="prefetch" href="/assets/AIChatPlugin.html-ZDjZq3Nj.js" as="script"><link rel="prefetch" href="/assets/AdditionalPylons.html-BMRyl4zg.js" as="script"><link rel="prefetch" href="/assets/AnnouncementBoxPlus.html-4M4ne31P.js" as="script"><link rel="prefetch" href="/assets/AutoAirItem.html-BvEsa15V.js" as="script"><link rel="prefetch" href="/assets/AutoBroadcast.html-BQBfqwON.js" as="script"><link rel="prefetch" href="/assets/AutoClassificationQuickStack.html-DSX_k8GV.js" as="script"><link rel="prefetch" href="/assets/AutoClear.html-Blhdgf6v.js" as="script"><link rel="prefetch" href="/assets/AutoFish.html-B76VCwFi.js" as="script"><link rel="prefetch" href="/assets/AutoPluginManager.html-vy7U45nD.js" as="script"><link rel="prefetch" href="/assets/AutoReset.html-ZrLKkpFf.js" as="script"><link rel="prefetch" href="/assets/AutoStoreItems.html-CTxRZM9p.js" as="script"><link rel="prefetch" href="/assets/AutoTeam.html-E_-4Jo6g.js" as="script"><link rel="prefetch" href="/assets/Back.html-CjDWi2tt.js" as="script"><link rel="prefetch" href="/assets/BadApplePlayer.html-Bbt10KtU.js" as="script"><link rel="prefetch" href="/assets/BagPing.html-CWpPwfiN.js" as="script"><link rel="prefetch" href="/assets/BanNpc.html-B64iNkfo.js" as="script"><link rel="prefetch" href="/assets/BedSet.html-DeBvhD-4.js" as="script"><link rel="prefetch" href="/assets/BetterWhitelist.html-C-5MuOQF.js" as="script"><link rel="prefetch" href="/assets/BossLock.html-DW7fOdvk.js" as="script"><link rel="prefetch" href="/assets/BridgeBuilder.html-BOyHrh7J.js" as="script"><link rel="prefetch" href="/assets/BuildMaster.html-C5kvRIo0.js" as="script"><link rel="prefetch" href="/assets/CGive.html-CBk08Wda.js" as="script"><link rel="prefetch" href="/assets/CNPCShop.html-XyEH3PGn.js" as="script"><link rel="prefetch" href="/assets/CaiBotLite.html-DvQZoFmp.js" as="script"><link rel="prefetch" href="/assets/CaiCustomEmojiCommand.html-QcR1hyDd.js" as="script"><link rel="prefetch" href="/assets/CaiPacketDebug.html-65pDl0Q_.js" as="script"><link rel="prefetch" href="/assets/CaiRewardChest.html-BwxzyA8o.js" as="script"><link rel="prefetch" href="/assets/Challenger.html-B3tcItrM.js" as="script"><link rel="prefetch" href="/assets/Chameleon.html-CeaQKCuo.js" as="script"><link rel="prefetch" href="/assets/ChattyBridge.html-02JqyWXW.js" as="script"><link rel="prefetch" href="/assets/ChestRestore.html-D487WaeP.js" as="script"><link rel="prefetch" href="/assets/Chireiden.TShock.Omni.html-ruPCNECn.js" as="script"><link rel="prefetch" href="/assets/ConsoleSql.html-BYxskk0H.js" as="script"><link rel="prefetch" href="/assets/ConvertWorld.html-CMxLSnzZ.js" as="script"><link rel="prefetch" href="/assets/CreateSpawn.html-ByvcbAMI.js" as="script"><link rel="prefetch" href="/assets/CriticalHit.html-CCjoDKxg.js" as="script"><link rel="prefetch" href="/assets/Crossplay.html-D-JQRucX.js" as="script"><link rel="prefetch" href="/assets/CustomMonster.html-B_5Rq5OD.js" as="script"><link rel="prefetch" href="/assets/DTEntryBlock.html-DF1D0fcc.js" as="script"><link rel="prefetch" href="/assets/DamageRuleLoot.html-Jplf4yrY.js" as="script"><link rel="prefetch" href="/assets/DamageStatistic.html-B5ImJ8L3.js" as="script"><link rel="prefetch" href="/assets/DataSync.html-CQcVTxlq.js" as="script"><link rel="prefetch" href="/assets/DeathDrop.html-ByJ5y_6d.js" as="script"><link rel="prefetch" href="/assets/DisableMonsLoot.html-BsBRvoMR.js" as="script"><link rel="prefetch" href="/assets/DonotFuck.html-4pzgAdZ1.js" as="script"><link rel="prefetch" href="/assets/Dummy.html-D2taGPZ8.js" as="script"><link rel="prefetch" href="/assets/DumpPluginsList.html-CRdSi7wC.js" as="script"><link rel="prefetch" href="/assets/DumpTerrariaID.html-ITEyBS0s.js" as="script"><link rel="prefetch" href="/assets/DwTP.html-CKkpy1TU.js" as="script"><link rel="prefetch" href="/assets/Economics.Core.html-DXGQnhoR.js" as="script"><link rel="prefetch" href="/assets/Economics.Deal.html-DO4Ez1RM.js" as="script"><link rel="prefetch" href="/assets/Economics.NPC.html-BwE2OTmh.js" as="script"><link rel="prefetch" href="/assets/Economics.Projectile.html-Cl_7PMqI.js" as="script"><link rel="prefetch" href="/assets/Economics.RPG.html-Dw2z52PJ.js" as="script"><link rel="prefetch" href="/assets/Economics.Regain.html-BN2gr7tN.js" as="script"><link rel="prefetch" href="/assets/Economics.Shop.html-DyVnuOlt.js" as="script"><link rel="prefetch" href="/assets/Economics.Skill.html-DQqC7yye.js" as="script"><link rel="prefetch" href="/assets/Economics.Task.html-D9MRdJza.js" as="script"><link rel="prefetch" href="/assets/Economics.WeaponPlus.html-B_Vs9cyt.js" as="script"><link rel="prefetch" href="/assets/EndureBoost.html-BBVYqb9O.js" as="script"><link rel="prefetch" href="/assets/EssentialsPlus.html-Cdm-kx3g.js" as="script"><link rel="prefetch" href="/assets/Ezperm.html-CN9uBi1V.js" as="script"><link rel="prefetch" href="/assets/FishShop.html-Di-Z73RX.js" as="script"><link rel="prefetch" href="/assets/GenerateMap.html-DvOCH2vA.js" as="script"><link rel="prefetch" href="/assets/GhostView.html-BDps7Y_J.js" as="script"><link rel="prefetch" href="/assets/GolfRewards.html-DlYKeYXh.js" as="script"><link rel="prefetch" href="/assets/GoodNight.html-KdVdPhBg.js" as="script"><link rel="prefetch" href="/assets/HardPlayerDrop.html-B2-L-vwv.js" as="script"><link rel="prefetch" href="/assets/HelpPlus.html-CcJ9PwIM.js" as="script"><link rel="prefetch" href="/assets/History.html-CqGevscu.js" as="script"><link rel="prefetch" href="/assets/HouseRegion.html-BHIn-Dyq.js" as="script"><link rel="prefetch" href="/assets/Invincibility.html-Dwom_Ll0.js" as="script"><link rel="prefetch" href="/assets/ItemBox.html-BXVbRs5Z.js" as="script"><link rel="prefetch" href="/assets/ItemDecoration.html-C9tV8B-0.js" as="script"><link rel="prefetch" href="/assets/ItemPreserver.html-iQ6g3vv2.js" as="script"><link rel="prefetch" href="/assets/JourneyUnlock.html-nuKFkTn_.js" as="script"><link rel="prefetch" href="/assets/Lagrange.XocMat.Adapter.html-DKq0_JTd.js" as="script"><link rel="prefetch" href="/assets/LazyAPI.html-CeWlu1RH.js" as="script"><link rel="prefetch" href="/assets/LifemaxExtra.html-liAxcPKf.js" as="script"><link rel="prefetch" href="/assets/ListPlugins.html-8F1SoxVs.js" as="script"><link rel="prefetch" href="/assets/MapTp.html-B8REXf1Y.js" as="script"><link rel="prefetch" href="/assets/MiniGamesAPI.html-CjIS5BxX.js" as="script"><link rel="prefetch" href="/assets/ModifyWeapons.html-DFLq7r0W.js" as="script"><link rel="prefetch" href="/assets/MonsterRegen.html-CKZ58WJZ.js" as="script"><link rel="prefetch" href="/assets/MusicPlayer.html-YIasGWRV.js" as="script"><link rel="prefetch" href="/assets/Noagent.html-BrzMKq_C.js" as="script"><link rel="prefetch" href="/assets/NormalDropsBags.html-DsMdnGx7.js" as="script"><link rel="prefetch" href="/assets/NoteWall.html-DRIVjtrh.js" as="script"><link rel="prefetch" href="/assets/OnlineGiftPackage.html-CFVr1vjN.js" as="script"><link rel="prefetch" href="/assets/PacketsStop.html-CX6_gQ7q.js" as="script"><link rel="prefetch" href="/assets/PerPlayerLoot.html-0gKtv8Li.js" as="script"><link rel="prefetch" href="/assets/PermaBuff.html-C4egnNIu.js" as="script"><link rel="prefetch" href="/assets/PersonalPermission.html-Bs4Y1bpL.js" as="script"><link rel="prefetch" href="/assets/Platform.html-CiS9gH6E.js" as="script"><link rel="prefetch" href="/assets/PlayerManager.html-D1snBKmV.js" as="script"><link rel="prefetch" href="/assets/PlayerRandomSwapper.html-DNB58fC-.js" as="script"><link rel="prefetch" href="/assets/PlayerSpeed.html-BzXDLH0g.js" as="script"><link rel="prefetch" href="/assets/ProgressBag.html-BEPSQYGs.js" as="script"><link rel="prefetch" href="/assets/ProgressControls.html-CM7J60Tg.js" as="script"><link rel="prefetch" href="/assets/ProgressRestrict.html-ZWEvHnMn.js" as="script"><link rel="prefetch" href="/assets/ProxyProtocolSocket.html-CXUzFHCJ.js" as="script"><link rel="prefetch" href="/assets/PvPer.html-B9D_wrBw.js" as="script"><link rel="prefetch" href="/assets/QRCoder.html-Coia1e94.js" as="script"><link rel="prefetch" href="/assets/RainbowChat.html-D7jO1P4a.js" as="script"><link rel="prefetch" href="/assets/RandRespawn.html-iVCa7h3C.js" as="script"><link rel="prefetch" href="/assets/RandomBroadcast.html-leWcIGjn.js" as="script"><link rel="prefetch" href="/assets/ReFishTask.html-Xokic0wg.js" as="script"><link rel="prefetch" href="/assets/RealTime.html-BFY9z89v.js" as="script"><link rel="prefetch" href="/assets/RebirthCoin.html-1Frn2w1q.js" as="script"><link rel="prefetch" href="/assets/RecipesBrowser.html-uG03sRuB.js" as="script"><link rel="prefetch" href="/assets/RegionView.html-BAaGz5Ta.js" as="script"><link rel="prefetch" href="/assets/Respawn.html-CVIVpss0.js" as="script"><link rel="prefetch" href="/assets/RestInventory.html-DTqzimgL.js" as="script"><link rel="prefetch" href="/assets/ReverseWorld.html-D45fyLRN.js" as="script"><link rel="prefetch" href="/assets/RolesModifying.html-BDXdwdJl.js" as="script"><link rel="prefetch" href="/assets/Sandstorm.html-BRPHrdYX.js" as="script"><link rel="prefetch" href="/assets/ServerTools.html-C7muwgax.js" as="script"><link rel="prefetch" href="/assets/SessionSentinel.html-LsxOyS52.js" as="script"><link rel="prefetch" href="/assets/ShortCommand.html-DgYjxJ9T.js" as="script"><link rel="prefetch" href="/assets/ShowArmors.html-8eRsv7g_.js" as="script"><link rel="prefetch" href="/assets/SignInSign.html-Y11N7w65.js" as="script"><link rel="prefetch" href="/assets/SimultaneousUseFix.html-BxJpARZm.js" as="script"><link rel="prefetch" href="/assets/SmartRegions.html-FOWz0vXR.js" as="script"><link rel="prefetch" href="/assets/SpawnInfra.html-Bl2iNMvu.js" as="script"><link rel="prefetch" href="/assets/SpclPerm.html-Dnzaeduz.js" as="script"><link rel="prefetch" href="/assets/StatusTextManager.html-BTRqkz5V.js" as="script"><link rel="prefetch" href="/assets/SurfaceBlock.html-B3JTJ642.js" as="script"><link rel="prefetch" href="/assets/SurvivalCrisis.html-CxJXOo7U.js" as="script"><link rel="prefetch" href="/assets/SwitchCommands.html-lN2GJBbD.js" as="script"><link rel="prefetch" href="/assets/TeleportRequest.html-CEbsY-id.js" as="script"><link rel="prefetch" href="/assets/TimeRate.html-MSVlqFOr.js" as="script"><link rel="prefetch" href="/assets/TimerKeeper.html-DOYjEovT.js" as="script"><link rel="prefetch" href="/assets/TownNPCHomes.html-DrEiL70J.js" as="script"><link rel="prefetch" href="/assets/TransferPatch.html-MXf3sHzr.js" as="script"><link rel="prefetch" href="/assets/UnseenInventory.html-L-rEAjRE.js" as="script"><link rel="prefetch" href="/assets/VBY.Common.html-DPwD0yRJ.js" as="script"><link rel="prefetch" href="/assets/VBY.GameContentModify.html-CXVZvm5G.js" as="script"><link rel="prefetch" href="/assets/VBY.OtherCommand.html-BkTjMBYt.js" as="script"><link rel="prefetch" href="/assets/VBY.PluginLoader.html-CO2SFXgF.js" as="script"><link rel="prefetch" href="/assets/VBY.PluginLoaderAutoReload.html-CDUyu8BM.js" as="script"><link rel="prefetch" href="/assets/VeinMiner.html-rIPSPDAU.js" as="script"><link rel="prefetch" href="/assets/VotePlus.html-DTIu9AoC.js" as="script"><link rel="prefetch" href="/assets/WeaponPlus.html-D5-FnVoB.js" as="script"><link rel="prefetch" href="/assets/WikiLangPackLoader.html-ylehUVE6.js" as="script"><link rel="prefetch" href="/assets/WorldModify.html-KtSHbTua.js" as="script"><link rel="prefetch" href="/assets/ZHIPlayerManager.html-BnlxwDeH.js" as="script"><link rel="prefetch" href="/assets/get-start.html-ccrMWE9q.js" as="script"><link rel="prefetch" href="/assets/CaiBotLite.html-DPX6LOEa.js" as="script"><link rel="prefetch" href="/assets/PatchouliBot.html-D3dF4IrF.js" as="script"><link rel="prefetch" href="/assets/TShockCPUTest.html-CL_VxI8x.js" as="script"><link rel="prefetch" href="/assets/TShockToolsNav.html-U7SHt_rz.js" as="script"><link rel="prefetch" href="/assets/TerrariaAI.html-B_exEs9C.js" as="script"><link rel="prefetch" href="/assets/get-start.html-J32Jn8G9.js" as="script"><link rel="prefetch" href="/assets/Part0.html-BZq9V2b4.js" as="script"><link rel="prefetch" href="/assets/Part1.html-B7x09Ygi.js" as="script"><link rel="prefetch" href="/assets/Part2.html-DxDOY3aA.js" as="script"><link rel="prefetch" href="/assets/Part3.html-Cb7MtBZA.js" as="script"><link rel="prefetch" href="/assets/Part4.html-ChGlmj4e.js" as="script"><link rel="prefetch" href="/assets/Part5.html-CerCMe22.js" as="script"><link rel="prefetch" href="/assets/Part6.0.html-B3SCqrzc.js" as="script"><link rel="prefetch" href="/assets/Part6.1.html-TznrzcM6.js" as="script"><link rel="prefetch" href="/assets/Part6.5.1.html-uKmGvAj-.js" as="script"><link rel="prefetch" href="/assets/Part6.5.2.html-rsfn0NI7.js" as="script"><link rel="prefetch" href="/assets/Part7.html-CHiWUHr2.js" as="script"><link rel="prefetch" href="/assets/get-start.html-OXqqqgNi.js" as="script"><link rel="prefetch" href="/assets/1-install-tshock.html-S_daC4_Z.js" as="script"><link rel="prefetch" href="/assets/2-init-tshock.html-8VkIVlpc.js" as="script"><link rel="prefetch" href="/assets/3-config-tshock.html-BYCwtHT9.js" as="script"><link rel="prefetch" href="/assets/4-permission-control.html-DKJ4AHdz.js" as="script"><link rel="prefetch" href="/assets/get-start.html-BiaggxVN.js" as="script"><link rel="prefetch" href="/assets/(中文)REST端点.html-BAGf2Ssh.js" as="script"><link rel="prefetch" href="/assets/(中文)docker.html-D6ibyjgl.js" as="script"><link rel="prefetch" href="/assets/(中文)i18n.html-BSHPKB2y.js" as="script"><link rel="prefetch" href="/assets/(中文)主配置(config.json).html-DJpLWFnC.js" as="script"><link rel="prefetch" href="/assets/(中文)主页.html-e1qSNywH.js" as="script"><link rel="prefetch" href="/assets/(中文)命令行参数.html-INnVKYqL.js" as="script"><link rel="prefetch" href="/assets/(中文)地图读写接口.html-BXg0l7kd.js" as="script"><link rel="prefetch" href="/assets/(中文)插件.html-BFQAy0OC.js" as="script"><link rel="prefetch" href="/assets/(中文)服务端角色(SSC).html-DVUU-NB-.js" as="script"><link rel="prefetch" href="/assets/(中文)服务端角色配置(sscconfig.json).html-BrxspSXU.js" as="script"><link rel="prefetch" href="/assets/(中文)权限说明.html-C4LiOItS.js" as="script"><link rel="prefetch" href="/assets/(中文)欢迎消息(motd.txt).html-sXFqQKL9.js" as="script"><link rel="prefetch" href="/assets/(中文)语言.html-C0He-pod.js" as="script"><link rel="prefetch" href="/assets/(中文)软件包.html-BMzVuYTA.js" as="script"><link rel="prefetch" href="/assets/get-start.html-BQXFHQ-v.js" as="script"><link rel="prefetch" href="/assets/404.html-CfOTzNKm.js" as="script"><link rel="prefetch" href="/assets/index-CboVVwbN.js" as="script"><link rel="prefetch" href="/assets/NpmBadge-BH_v1NDx.js" as="script"><link rel="prefetch" href="/assets/PaletteDemo-Dkn3a8vk.js" as="script"><link rel="prefetch" href="/assets/PaletteDisplay-DHUH9d9P.js" as="script"><link rel="prefetch" href="/assets/ToggleRTLButton-BXX72Lhf.js" as="script"><link rel="prefetch" href="/assets/VPAutoLink-DxG07Y3k.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/zh/"><img class="vp-site-logo" src="/images/hero.png" alt="TShock中文插件库"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">TShock中文插件库</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/guide/get-start.html" aria-label="插件文档"><!--[--><!--[--><!----><!--]--><!--]-->插件文档<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/tshock/get-start.html" aria-label="TShock教程"><!--[--><!--[--><!----><!--]--><!--]-->TShock教程<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/plugin-dev/get-start.html" aria-label="插件开发"><!--[--><!--[--><!----><!--]--><!--]-->插件开发<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/tshock-wiki/get-start.html" aria-label="TShock Wiki 镜像"><!--[--><!--[--><!----><!--]--><!--]-->TShock Wiki 镜像<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/other/get-start.html" aria-label="其他文档"><!--[--><!--[--><!----><!--]--><!--]-->其他文档<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/zh/plugin-dev/Part6.2.html" aria-label="简体中文"><!--[--><!--[--><!----><!--]--><!--]-->简体中文<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/en/" aria-label="en-US"><!--[--><!--[--><!----><!--]--><!--]-->en-US<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/UnrealMultiple/TShockPlugin" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><iconify-icon class="vp-icon auto-link-icon" icon="lucide:github" sizing="height" height="1em"></iconify-icon><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="切换颜色模式"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/guide/get-start.html" aria-label="插件文档"><!--[--><!--[--><!----><!--]--><!--]-->插件文档<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/tshock/get-start.html" aria-label="TShock教程"><!--[--><!--[--><!----><!--]--><!--]-->TShock教程<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/plugin-dev/get-start.html" aria-label="插件开发"><!--[--><!--[--><!----><!--]--><!--]-->插件开发<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/tshock-wiki/get-start.html" aria-label="TShock Wiki 镜像"><!--[--><!--[--><!----><!--]--><!--]-->TShock Wiki 镜像<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zh/other/get-start.html" aria-label="其他文档"><!--[--><!--[--><!----><!--]--><!--]-->其他文档<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="选择语言"><span class="title">选择语言</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/zh/plugin-dev/Part6.2.html" aria-label="简体中文"><!--[--><!--[--><!----><!--]--><!--]-->简体中文<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/en/" aria-label="en-US"><!--[--><!--[--><!----><!--]--><!--]-->en-US<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/UnrealMultiple/TShockPlugin" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><iconify-icon class="vp-icon auto-link-icon" icon="lucide:github" sizing="height" height="1em"></iconify-icon><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/get-start.html" aria-label="Caiの插件教程"><!--[--><!--[--><!----><!--]--><!--]-->Caiの插件教程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part0.html" aria-label="Part 0.配置开发环境​"><!--[--><!--[--><!----><!--]--><!--]-->Part 0.配置开发环境​<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part1.html" aria-label="Part 1.编写你的第一个插件​"><!--[--><!--[--><!----><!--]--><!--]-->Part 1.编写你的第一个插件​<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part2.html" aria-label="Part 2.初步了解TShock插件模板​"><!--[--><!--[--><!----><!--]--><!--]-->Part 2.初步了解TShock插件模板​<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part3.html" aria-label="Part 3.添加新命令​"><!--[--><!--[--><!----><!--]--><!--]-->Part 3.添加新命令​<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part4.html" aria-label="Part 4.挂钩钩~"><!--[--><!--[--><!----><!--]--><!--]-->Part 4.挂钩钩~<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part5.html" aria-label="Part 5.玩家对象​"><!--[--><!--[--><!----><!--]--><!--]-->Part 5.玩家对象​<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part6.0.html" aria-label="Part 6.0 数据包基础"><!--[--><!--[--><!----><!--]--><!--]-->Part 6.0 数据包基础<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part6.1.html" aria-label="Part 6.1 读取数据包 (超难理解)"><!--[--><!--[--><!----><!--]--><!--]-->Part 6.1 读取数据包 (超难理解)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/zh/plugin-dev/Part6.2.html" aria-label="Part 6.1发送数据包​"><!--[--><!--[--><!----><!--]--><!--]-->Part 6.1发送数据包​<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part6.5.1.html" aria-label="Part 6.5.1 数据包参考表格(1.4.4.9) (by @xuyuwtu &amp; @ACaiCat)"><!--[--><!--[--><!----><!--]--><!--]-->Part 6.5.1 数据包参考表格(1.4.4.9) (by @xuyuwtu &amp; @ACaiCat)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part6.5.2.html" aria-label="Part 6.5.2 客户端与服务端的连接 (不要求学会，仅做参考)"><!--[--><!--[--><!----><!--]--><!--]-->Part 6.5.2 客户端与服务端的连接 (不要求学会，仅做参考)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/zh/plugin-dev/Part7.html" aria-label="Part 7.插件配置文件 (临时加更)"><!--[--><!--[--><!----><!--]--><!--]-->Part 7.插件配置文件 (临时加更)<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="part-6-1发送数据包​" tabindex="-1"><a class="header-anchor" href="#part-6-1发送数据包​"><span>Part 6.1发送数据包​</span></a></h1><p>本章你将学到：</p><ul><li>如何向玩家发送数据包</li><li>研究不同数据包参数的方法</li></ul><h2 id="什么是数据包-​" tabindex="-1"><a class="header-anchor" href="#什么是数据包-​"><span>什么是数据包？​</span></a></h2><ul><li>顾名思义，数据包就是存放数据的包。这些包会告诉玩家的客户端一些游戏内的信息(例如物品掉落、地图时间等)，当然服务器也可以接受来自玩家的数据包​</li></ul><h2 id="为什么要发送数据包-​" tabindex="-1"><a class="header-anchor" href="#为什么要发送数据包-​"><span>为什么要发送数据包？​</span></a></h2><ul><li>当你直接修改Terraria服务端中的属性、变量等(例如：玩家最大血量、下雨等)，你会发现你的修改没办法马上生效，这时候就需要向玩家发送一个数据包用来告诉客户端你修改的信息</li></ul><h2 id="如何发送数据包-​" tabindex="-1"><a class="header-anchor" href="#如何发送数据包-​"><span>如何发送数据包？​</span></a></h2><ul><li>我们可以调用TSPlayer对象中的SendData方法来发送数据包</li></ul><ol><li><p>首先我们需要获取对应的TSPlayer对象，前面教程已经有了，就不在过多赘述</p><blockquote><p>注: 如果你需要发送全服数据包玩家对象就是TSPlayer.All</p></blockquote></li><li><p>然后使用SendData方法</p></li></ol><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-csharp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SendData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">数据包类型</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">字符串参数</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">参数1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">参数2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>以修改玩家最大生命值为例：</li></ul><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-csharp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TestCmd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">CommandArgs</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//以命令为例</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    var</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> player</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">Player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//获取玩家的对象</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">TPlayer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">statLifeMax</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 11451</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//修改玩家最大生命值(注意: statLifeMax2是加上药水饰品等的最大生命值)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SendData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PacketTypes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PlayerHp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">Index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//向玩家发送数据包更新</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>此时你应该会想问:<br> WTF?<br> 为什么数据包类型是PlayerHp，为什么参数1是玩家的索引(player.Index)，为什么SendData的参数里没有我要改的血量11451?</p></blockquote><h2 id="发送数据包-senddata-的参数-​" tabindex="-1"><a class="header-anchor" href="#发送数据包-senddata-的参数-​"><span>发送数据包(SendData)的参数:​</span></a></h2><p>这里有一个奇怪的误区，SendData的参数并不一定是写进数据包的值(上面例子中:参数1是player.Index而不是TPlayer.statLifeMax)，对于不同的数据包SendData的参数也会有所不同。想要知道具体参数作用，我们需要反编译NetMessage.orig_SendData 方法如下</p><ol><li>直接在可以执行语句的地方打一个NetMessage.orig_SendData，然后右键orig_SendData，点击转到定义,等待一下反编译我们就能看到NetMessage.orig_SendData的代码了</li></ol><p><img src="/assets/bfcfbacc-3a63-46be-9f66-3a7f64cf2955-DqDHeGRr.jpg" alt="image"></p><ol start="2"><li>往下翻，我们会发现有一个switch-case结构, 其中case中的数字就是数据包的编号</li></ol><p><img src="/assets/ef96205f-b82a-4a8d-b0ed-9c024f1d8ff6-DBLuMbDp.jpg" alt="image"></p><ul><li>以修改玩家最大生命为例(修改了玩家的statLifeMax)</li></ul><ol><li><p>我们直接按Ctrl+F搜索statLifeMax</p></li><li><p>此时搜索到16号数据包的case，所以我们需要发送的就是16号数据包(PacketTypes.PlayerHp) <img src="/assets/378110c7-74ac-4cf3-a48b-25b265e8c911-DNC5k7Mi.jpg" alt="image"></p></li><li><p>我们仔细查看这个case部分不难看出, number(参数1)，就是玩家的索引(number为0时发送索引为0的玩家的生命数据，number为1时发送索引为1的玩家的生命数据...) [number2对应参数2，number3对应参数3，有些数据包需要用到字符串参数(例如: 弹幕文字、断开连接等)]</p></li></ol><blockquote><p>注: 你可以用类似的方法查看PacketTypes的定义来找到数据包类型(16=&gt;PacketTypes.PlayerHp) 如果你嫌麻烦也可以直接使用&quot;(PacketTypes)数据包号&quot;<br> [例如: (PacketTypes)16]</p></blockquote><ol start="4"><li>得出PacketTypes.PlayerHp</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-csharp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SendData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PacketTypes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PlayerHp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">玩家索引</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="再分析一个数据包试试​" tabindex="-1"><a class="header-anchor" href="#再分析一个数据包试试​"><span>再分析一个数据包试试​</span></a></h2><ol><li>假设我们现在想把服务器中的世纪之花设置为已击败状态(NPC.downedPlantBoss=true),我们现在需要告诉所有的玩家世纪之花已被击败而不是执行命令的人，所以我们需要使用TSPlayer.All作为对象</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-csharp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TestCmd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">CommandArgs</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//测试命令 (这里只是方便演示)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    NPC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">downedPlantBoss</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//设置世纪之花为已击败状态</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    TSPlayer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">All</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SendData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">数据包</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">，</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">参数1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">参数2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">..); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//向所有玩家发送数据包</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>然后我们转到NetMessage.orig_SendData()搜索downedPlantBoss，找到对应的位置后，详细的阅读这个case中的代码找number，</li><li>发现这个case中没有使用任何number或者text (不需要任何参数和文本)</li></ol><p><img src="/assets/b1016bc4-3cf6-4589-9c62-8be0430bf44f-Dll6Z086.jpg" alt="image"></p><ol start="4"><li>所以我们直接调用下面的方法就可以发送数据包了 (由于7号数据包没有使用任何参数和文本，所以我们直接只填入包类型就好)</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-csharp"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> TestCmd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">CommandArgs</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    NPC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">downedPlantBoss</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//设置世纪之花为已击败状态</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    TSPlayer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">All</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SendData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PacketTypes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">WorldInfo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//通过查看PacketTypes的定义可以找到数据包编号(7)对应的和PacketTypes(PacketTypes.WorldInfo)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //也可以直接使用TSPlayer.All.SendData((PacketTypes)7); 但是PacketTypes.WorldInfo的代码可读性更高</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="奇怪的东西" tabindex="-1"><a class="header-anchor" href="#奇怪的东西"><span>奇怪的东西</span></a></h2><ol><li>有一个编写插件常常用到的数据包PlayerSlot(5号)，这个数据包的作用是修改玩家背包的物品(包括装备栏的物品)<br> 我们转到NetMessage.orig_SendData() 找到5号的对应代码</li></ol><p><img src="/assets/390c270e-fb23-4fc4-bac9-2eb6fa9eb988-BU8imI7b.jpg" alt="image"></p><ol start="2"><li>从上面的代码我们能发现number(参数1)是玩家的索引(Index), number2(参数2)是对应格子的索引，而number3(参数3)却很难看出他的作用，此时我们可以通过查看MessageBuffer.GetData的定义来找到number3的作用</li></ol><p><img src="/assets/3b324de0-71b4-4fcc-8d14-8d966318cd2e-iNXUNE8l.jpg" alt="image"></p><ol start="3"><li>根据NetMessage.orig_SendData()中代码number3在第4次被Write进数据包, 那么number3在MessageBuffer.GetData中也会在第4次被Read进变量中，所以MessageBuffer.GetData中的num9就是NetMessage.orig_SendData()中的number3(参数3)，然后我们发现，在使用Prefix方法的时候使用了num9(也就是number3)，从wiki上我们可以知道prefix是修饰语的意思，所以number3就是修饰语ID</li></ol><p><img src="/assets/36559065-9475-4402-b9bc-4ec1ec5c8052-nynsAzwQ.jpg" alt="image"></p><ol start="4"><li>得出:</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-csharp"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SendData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PacketTypes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">PlayerSlot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">玩家索引</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">背包格子索引</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">物品修饰语ID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">上次更新: </span><time class="meta-item-info" datetime="2025-09-11T05:14:27.000Z" data-allow-mismatch>2025/9/11 05:14</time></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/zh/plugin-dev/Part6.1.html" aria-label="Part 6.1 读取数据包 (超难理解)"><!--[--><div class="hint"><span class="arrow left"></span> 上一篇</div><div class="link"><span class="external-link">Part 6.1 读取数据包 (超难理解)</span></div><!--]--></a><a class="route-link auto-link next" href="/zh/plugin-dev/Part6.5.1.html" aria-label="Part 6.5.1 数据包参考表格(1.4.4.9) (by @xuyuwtu &amp; @ACaiCat)"><!--[--><div class="hint">下一篇 <span class="arrow right"></span></div><div class="link"><span class="external-link">Part 6.5.1 数据包参考表格(1.4.4.9) (by @xuyuwtu &amp; @ACaiCat)</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DaEuJxNx.js" defer></script>
  </body>
</html>
